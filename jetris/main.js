(()=>{var Se=Object.create,ct=Object.defineProperty,Oe=Object.getPrototypeOf,Be=Object.prototype.hasOwnProperty,Ee=Object.getOwnPropertyNames,Pe=Object.getOwnPropertyDescriptor;var ke=t=>ct(t,"__esModule",{value:!0});var Ie=(t,o)=>()=>(o||(o={exports:{}},t(o.exports,o)),o.exports);var _e=(t,o,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let r of Ee(o))!Be.call(t,r)&&r!=="default"&&ct(t,r,{get:()=>o[r],enumerable:!(n=Pe(o,r))||n.enumerable});return t},Re=t=>_e(ke(ct(t!=null?Se(Oe(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var $t=Ie((pi,it)=>{(function(){function t(e,s,l){return e.call.apply(e.bind,arguments)}function o(e,s,l){if(!e)throw Error();if(2<arguments.length){var a=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,a),e.apply(s,c)}}return function(){return e.apply(s,arguments)}}function n(e,s,l){return n=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?t:o,n.apply(null,arguments)}var r=Date.now||function(){return+new Date};function u(e,s){this.a=e,this.o=s||e,this.c=this.o.document}var h=!!window.FontFace;function p(e,s,l,a){if(s=e.c.createElement(s),l)for(var c in l)l.hasOwnProperty(c)&&(c=="style"?s.style.cssText=l[c]:s.setAttribute(c,l[c]));return a&&s.appendChild(e.c.createTextNode(a)),s}function g(e,s,l){e=e.c.getElementsByTagName(s)[0],e||(e=document.documentElement),e.insertBefore(l,e.lastChild)}function T(e){e.parentNode&&e.parentNode.removeChild(e)}function y(e,s,l){s=s||[],l=l||[];for(var a=e.className.split(/\s+/),c=0;c<s.length;c+=1){for(var f=!1,d=0;d<a.length;d+=1)if(s[c]===a[d]){f=!0;break}f||a.push(s[c])}for(s=[],c=0;c<a.length;c+=1){for(f=!1,d=0;d<l.length;d+=1)if(a[c]===l[d]){f=!0;break}f||s.push(a[c])}e.className=s.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function w(e,s){for(var l=e.className.split(/\s+/),a=0,c=l.length;a<c;a++)if(l[a]==s)return!0;return!1}function O(e){return e.o.location.hostname||e.a.location.hostname}function R(e,s,l){function a(){D&&c&&f&&(D(d),D=null)}s=p(e,"link",{rel:"stylesheet",href:s,media:"all"});var c=!1,f=!0,d=null,D=l||null;h?(s.onload=function(){c=!0,a()},s.onerror=function(){c=!0,d=Error("Stylesheet failed to load"),a()}):setTimeout(function(){c=!0,a()},0),g(e,"head",s)}function ot(e,s,l,a){var c=e.c.getElementsByTagName("head")[0];if(c){var f=p(e,"script",{src:s}),d=!1;return f.onload=f.onreadystatechange=function(){d||this.readyState&&this.readyState!="loaded"&&this.readyState!="complete"||(d=!0,l&&l(null),f.onload=f.onreadystatechange=null,f.parentNode.tagName=="HEAD"&&c.removeChild(f))},c.appendChild(f),setTimeout(function(){d||(d=!0,l&&l(Error("Script load timeout")))},a||5e3),f}return null}function Tt(){this.a=0,this.c=null}function gt(e){return e.a++,function(){e.a--,wt(e)}}function xt(e,s){e.c=s,wt(e)}function wt(e){e.a==0&&e.c&&(e.c(),e.c=null)}function Dt(e){this.a=e||"-"}Dt.prototype.c=function(e){for(var s=[],l=0;l<arguments.length;l++)s.push(arguments[l].replace(/[\W_]+/g,"").toLowerCase());return s.join(this.a)};function k(e,s){this.c=e,this.f=4,this.a="n";var l=(s||"n4").match(/^([nio])([1-9])$/i);l&&(this.a=l[1],this.f=parseInt(l[2],10))}function se(e){return vt(e)+" "+(e.f+"00")+" 300px "+yt(e.c)}function yt(e){var s=[];e=e.split(/,\s*/);for(var l=0;l<e.length;l++){var a=e[l].replace(/['"]/g,"");a.indexOf(" ")!=-1||/^\d/.test(a)?s.push("'"+a+"'"):s.push(a)}return s.join(",")}function P(e){return e.a+e.f}function vt(e){var s="normal";return e.a==="o"?s="oblique":e.a==="i"&&(s="italic"),s}function oe(e){var s=4,l="n",a=null;return e&&((a=e.match(/(normal|oblique|italic)/i))&&a[1]&&(l=a[1].substr(0,1).toLowerCase()),(a=e.match(/([1-9]00|normal|bold)/i))&&a[1]&&(/bold/i.test(a[1])?s=7:/[1-9]00/.test(a[1])&&(s=parseInt(a[1].substr(0,1),10)))),l+s}function ne(e,s){this.c=e,this.f=e.o.document.documentElement,this.h=s,this.a=new Dt("-"),this.j=s.events!==!1,this.g=s.classes!==!1}function ae(e){e.g&&y(e.f,[e.a.c("wf","loading")]),b(e,"loading")}function mt(e){if(e.g){var s=w(e.f,e.a.c("wf","active")),l=[],a=[e.a.c("wf","loading")];s||l.push(e.a.c("wf","inactive")),y(e.f,l,a)}b(e,"inactive")}function b(e,s,l){e.j&&e.h[s]&&(l?e.h[s](l.c,P(l)):e.h[s]())}function le(){this.c={}}function re(e,s,l){var a=[],c;for(c in s)if(s.hasOwnProperty(c)){var f=e.c[c];f&&a.push(f(s[c],l))}return a}function Z(e,s){this.c=e,this.f=s,this.a=p(this.c,"span",{"aria-hidden":"true"},this.f)}function U(e){g(e.c,"body",e.a)}function Y(e){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+yt(e.c)+";"+("font-style:"+vt(e)+";font-weight:"+(e.f+"00")+";")}function St(e,s,l,a,c,f){this.g=e,this.j=s,this.a=a,this.c=l,this.f=c||3e3,this.h=f||void 0}St.prototype.start=function(){var e=this.c.o.document,s=this,l=r(),a=new Promise(function(d,D){function v(){r()-l>=s.f?D():e.fonts.load(se(s.a),s.h).then(function(m){1<=m.length?d():setTimeout(v,25)},function(){D()})}v()}),c=null,f=new Promise(function(d,D){c=setTimeout(D,s.f)});Promise.race([f,a]).then(function(){c&&(clearTimeout(c),c=null),s.g(s.a)},function(){s.j(s.a)})};function Ot(e,s,l,a,c,f,d){this.v=e,this.B=s,this.c=l,this.a=a,this.s=d||"BESbswy",this.f={},this.w=c||3e3,this.u=f||null,this.m=this.j=this.h=this.g=null,this.g=new Z(this.c,this.s),this.h=new Z(this.c,this.s),this.j=new Z(this.c,this.s),this.m=new Z(this.c,this.s),e=new k(this.a.c+",serif",P(this.a)),e=Y(e),this.g.a.style.cssText=e,e=new k(this.a.c+",sans-serif",P(this.a)),e=Y(e),this.h.a.style.cssText=e,e=new k("serif",P(this.a)),e=Y(e),this.j.a.style.cssText=e,e=new k("sans-serif",P(this.a)),e=Y(e),this.m.a.style.cssText=e,U(this.g),U(this.h),U(this.j),U(this.m)}var q={D:"serif",C:"sans-serif"},nt=null;function Bt(){if(nt===null){var e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);nt=!!e&&(536>parseInt(e[1],10)||parseInt(e[1],10)===536&&11>=parseInt(e[2],10))}return nt}Ot.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=r(),Pt(this)};function Et(e,s,l){for(var a in q)if(q.hasOwnProperty(a)&&s===e.f[q[a]]&&l===e.f[q[a]])return!0;return!1}function Pt(e){var s=e.g.a.offsetWidth,l=e.h.a.offsetWidth,a;(a=s===e.f.serif&&l===e.f["sans-serif"])||(a=Bt()&&Et(e,s,l)),a?r()-e.A>=e.w?Bt()&&Et(e,s,l)&&(e.u===null||e.u.hasOwnProperty(e.a.c))?at(e,e.v):at(e,e.B):ce(e):at(e,e.v)}function ce(e){setTimeout(n(function(){Pt(this)},e),50)}function at(e,s){setTimeout(n(function(){T(this.g.a),T(this.h.a),T(this.j.a),T(this.m.a),s(this.a)},e),0)}function lt(e,s,l){this.c=e,this.a=s,this.f=0,this.m=this.j=!1,this.s=l}var Q=null;lt.prototype.g=function(e){var s=this.a;s.g&&y(s.f,[s.a.c("wf",e.c,P(e).toString(),"active")],[s.a.c("wf",e.c,P(e).toString(),"loading"),s.a.c("wf",e.c,P(e).toString(),"inactive")]),b(s,"fontactive",e),this.m=!0,kt(this)},lt.prototype.h=function(e){var s=this.a;if(s.g){var l=w(s.f,s.a.c("wf",e.c,P(e).toString(),"active")),a=[],c=[s.a.c("wf",e.c,P(e).toString(),"loading")];l||a.push(s.a.c("wf",e.c,P(e).toString(),"inactive")),y(s.f,a,c)}b(s,"fontinactive",e),kt(this)};function kt(e){--e.f==0&&e.j&&(e.m?(e=e.a,e.g&&y(e.f,[e.a.c("wf","active")],[e.a.c("wf","loading"),e.a.c("wf","inactive")]),b(e,"active")):mt(e.a))}function It(e){this.j=e,this.a=new le,this.h=0,this.f=this.g=!0}It.prototype.load=function(e){this.c=new u(this.j,e.context||this.j),this.g=e.events!==!1,this.f=e.classes!==!1,ue(this,new ne(this.c,e),e)};function he(e,s,l,a,c){var f=--e.h==0;(e.f||e.g)&&setTimeout(function(){var d=c||null,D=a||null||{};if(l.length===0&&f)mt(s.a);else{s.f+=l.length,f&&(s.j=f);var v,m=[];for(v=0;v<l.length;v++){var S=l[v],B=D[S.c],I=s.a,W=S;if(I.g&&y(I.f,[I.a.c("wf",W.c,P(W).toString(),"loading")]),b(I,"fontloading",W),I=null,Q===null)if(window.FontFace){var W=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),me=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);Q=W?42<parseInt(W[1],10):!me}else Q=!1;Q?I=new St(n(s.g,s),n(s.h,s),s.c,S,s.s,B):I=new Ot(n(s.g,s),n(s.h,s),s.c,S,s.s,d,B),m.push(I)}for(v=0;v<m.length;v++)m[v].start()}},0)}function ue(e,s,l){var a=[],c=l.timeout;ae(s);var a=re(e.a,l,e.c),f=new lt(e.c,s,c);for(e.h=a.length,s=0,l=a.length;s<l;s++)a[s].load(function(d,D,v){he(e,f,d,D,v)})}function _t(e,s){this.c=e,this.a=s}_t.prototype.load=function(e){function s(){if(f["__mti_fntLst"+a]){var d=f["__mti_fntLst"+a](),D=[],v;if(d)for(var m=0;m<d.length;m++){var S=d[m].fontfamily;d[m].fontStyle!=null&&d[m].fontWeight!=null?(v=d[m].fontStyle+d[m].fontWeight,D.push(new k(S,v))):D.push(new k(S))}e(D)}else setTimeout(function(){s()},50)}var l=this,a=l.a.projectId,c=l.a.version;if(a){var f=l.c.o;ot(this.c,(l.a.api||"https://fast.fonts.net/jsapi")+"/"+a+".js"+(c?"?v="+c:""),function(d){d?e([]):(f["__MonotypeConfiguration__"+a]=function(){return l.a},s())}).id="__MonotypeAPIScript__"+a}else e([])};function Rt(e,s){this.c=e,this.a=s}Rt.prototype.load=function(e){var s,l,a=this.a.urls||[],c=this.a.families||[],f=this.a.testStrings||{},d=new Tt;for(s=0,l=a.length;s<l;s++)R(this.c,a[s],gt(d));var D=[];for(s=0,l=c.length;s<l;s++)if(a=c[s].split(":"),a[1])for(var v=a[1].split(","),m=0;m<v.length;m+=1)D.push(new k(a[0],v[m]));else D.push(new k(a[0]));xt(d,function(){e(D,f)})};function fe(e,s){e?this.c=e:this.c=de,this.a=[],this.f=[],this.g=s||""}var de="https://fonts.googleapis.com/css";function pe(e,s){for(var l=s.length,a=0;a<l;a++){var c=s[a].split(":");c.length==3&&e.f.push(c.pop());var f="";c.length==2&&c[1]!=""&&(f=":"),e.a.push(c.join(f))}}function Te(e){if(e.a.length==0)throw Error("No fonts to load!");if(e.c.indexOf("kit=")!=-1)return e.c;for(var s=e.a.length,l=[],a=0;a<s;a++)l.push(e.a[a].replace(/ /g,"+"));return s=e.c+"?family="+l.join("%7C"),0<e.f.length&&(s+="&subset="+e.f.join(",")),0<e.g.length&&(s+="&text="+encodeURIComponent(e.g)),s}function ge(e){this.f=e,this.a=[],this.c={}}var At={latin:"BESbswy","latin-ext":"\xE7\xF6\xFC\u011F\u015F",cyrillic:"\u0439\u044F\u0416",greek:"\u03B1\u03B2\u03A3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},xe={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},we={i:"i",italic:"i",n:"n",normal:"n"},De=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function ye(e){for(var s=e.f.length,l=0;l<s;l++){var a=e.f[l].split(":"),c=a[0].replace(/\+/g," "),f=["n4"];if(2<=a.length){var d,D=a[1];if(d=[],D)for(var D=D.split(","),v=D.length,m=0;m<v;m++){var S;if(S=D[m],S.match(/^[\w-]+$/)){var B=De.exec(S.toLowerCase());if(B==null)S="";else{if(S=B[2],S=S==null||S==""?"n":we[S],B=B[1],B==null||B=="")B="4";else var I=xe[B],B=I||(isNaN(B)?"4":B.substr(0,1));S=[S,B].join("")}}else S="";S&&d.push(S)}0<d.length&&(f=d),a.length==3&&(a=a[2],d=[],a=a?a.split(","):d,0<a.length&&(a=At[a[0]])&&(e.c[c]=a))}for(e.c[c]||(a=At[c])&&(e.c[c]=a),a=0;a<f.length;a+=1)e.a.push(new k(c,f[a]))}}function Lt(e,s){this.c=e,this.a=s}var ve={Arimo:!0,Cousine:!0,Tinos:!0};Lt.prototype.load=function(e){var s=new Tt,l=this.c,a=new fe(this.a.api,this.a.text),c=this.a.families;pe(a,c);var f=new ge(c);ye(f),R(l,Te(a),gt(s)),xt(s,function(){e(f.a,f.c,ve)})};function Ht(e,s){this.c=e,this.a=s}Ht.prototype.load=function(e){var s=this.a.id,l=this.c.o;s?ot(this.c,(this.a.api||"https://use.typekit.net")+"/"+s+".js",function(a){if(a)e([]);else if(l.Typekit&&l.Typekit.config&&l.Typekit.config.fn){a=l.Typekit.config.fn;for(var c=[],f=0;f<a.length;f+=2)for(var d=a[f],D=a[f+1],v=0;v<D.length;v++)c.push(new k(d,D[v]));try{l.Typekit.load({events:!1,classes:!1,async:!0})}catch(m){}e(c)}},2e3):e([])};function Ct(e,s){this.c=e,this.f=s,this.a=[]}Ct.prototype.load=function(e){var s=this.f.id,l=this.c.o,a=this;s?(l.__webfontfontdeckmodule__||(l.__webfontfontdeckmodule__={}),l.__webfontfontdeckmodule__[s]=function(c,f){for(var d=0,D=f.fonts.length;d<D;++d){var v=f.fonts[d];a.a.push(new k(v.name,oe("font-weight:"+v.weight+";font-style:"+v.style)))}e(a.a)},ot(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+O(this.c)+"/"+s+".js",function(c){c&&e([])})):e([])};var H=new It(window);H.a.c.custom=function(e,s){return new Rt(s,e)},H.a.c.fontdeck=function(e,s){return new Ct(s,e)},H.a.c.monotype=function(e,s){return new _t(s,e)},H.a.c.typekit=function(e,s){return new Ht(s,e)},H.a.c.google=function(e,s){return new Lt(s,e)};var rt={load:n(H.load,H)};typeof define=="function"&&define.amd?define(function(){return rt}):typeof it!="undefined"&&it.exports?it.exports=rt:(window.WebFont=rt,window.WebFontConfig&&H.load(window.WebFontConfig))})()});var x=Tiles={BLUE:0,CYAN:1,ORANGE:2,YELLOW:3,GREEN:4,RED:5,PURPLE:6,BOARD:7,BORDER_BOTTOM:8,BORDER_LEFT:9,BORDER_TOP:10,BORDER_RIGHT:11,GHOST:12,HELPER:13,EMPTY:14,EMPTY2:15,BORDER_CORNER_BOTTOM_LEFT:16,BORDER_CORNER_TOP_LEFT:17,BORDER_CORNER_TOP_RIGHT:18,BORDER_CORNER_BOTTOM_RIGHT:19,BONUS_2X:20,BONUS_3X:21,BONUS_4X:22};cos=Math.cos(Math.PI/2);sin=Math.sin(Math.PI/2);RotationMatrix=[cos,sin,-sin,cos];var J={L:"L",I:"I",J:"J",O:"O",S:"S",T:"T",Z:"Z"},Ae={L:x.ORANGE,I:x.CYAN,J:x.BLUE,O:x.YELLOW,S:x.GREEN,T:x.PURPLE,Z:x.RED},F={I:[[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],[[0,0],[-1,0],[2,0],[-1,2],[2,-1]],[[0,0],[1,0],[-2,0],[1,-2],[-2,1]],[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],[[0,0],[1,0],[-2,0],[1,-2],[-2,1]],[[0,0],[-1,0],[2,0],[-1,2],[2,-1]]],JLOSTZ:[[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]],[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]]]};var Le={I:[0,0],O:[0,0],J:[-.5,.5],L:[-.5,.5],S:[-.5,.5],T:[-.5,.5],Z:[-.5,.5]},V={L:{cells:[[1,1],[-1,0],[0,0],[1,0]],wallKicks:F.JLOSTZ,color:16774400},I:{cells:[[-1,1],[0,1],[1,1],[2,1]],wallKicks:F.I,color:17919},J:{cells:[[-1,1],[-1,0],[0,0],[1,0]],wallKicks:F.JLOSTZ,color:255},O:{cells:[[0,0],[1,0],[0,1],[1,1]],wallKicks:F.JLOSTZ,color:16776960},S:{cells:[[-1,0],[0,0],[0,1],[1,1]],wallKicks:F.JLOSTZ,color:65280},T:{cells:[[-1,0],[0,0],[1,0],[0,1]],wallKicks:F.JLOSTZ,color:15728880},Z:{cells:[[-1,1],[0,1],[0,0],[1,0]],wallKicks:F.JLOSTZ,color:16711680}};function z(t){return JSON.parse(JSON.stringify(t))}function j(t,o){let n=o.getData("cells"),r=o.getData("x"),u=o.getData("y");if(t.checkFractions(r,u))return;let h=BOARD_WIDTH,p=0,g=BOARD_HEIGHT,T=0;for(let y=0;y<n.length;y++)for(let w=0;w<n[y].length-1;w++){if(t.checkFractions(n[y][w],n[y][w+1]))return;h=Math.min(h,r+n[y][w]),p=Math.max(p,r+n[y][w]),g=Math.min(g,u+n[y][w+1]),T=Math.max(T,u+n[y][w+1])}return new Phaser.Geom.Rectangle(t.map.tileToWorldX(h),t.map.tileToWorldY(19-T)+BLOCK_SIZE*t.gameScale,t.map.tileToWorldX(p)-t.map.tileToWorldX(h)+BLOCK_SIZE*t.gameScale,t.map.tileToWorldY(19-g)-t.map.tileToWorldY(19-T)+BLOCK_SIZE*t.gameScale)}function M(t,o){let n=V[o],r=t.add.container(0,0);return r.setData("cells",z(n.cells)),r.setData("color",n.color),r.setData("wallKicks",n.wallKicks),r.setData("tile",Ae[o]),r.setData("type",o),r.setData("rotationIndex",0),r.setData("rotation",[0,0]),r.setData("x",0),r.setData("y",0),DEBUG&&console.log("Created tetromino: ",r),r}function Ft(t,o,n){let r=o.getData("type"),u=V[r],h=t.add.container(0,0).setScale(n);return h.setData("tile",x.GHOST),h.setData("cells",z(o.getData("cells"))),h.setData("type",o.getData("type")),h.setData("rotationIndex",o.getData("rotationIndex")),h.setData("rotation",o.getData("rotation")),h.setData("x",o.getData("x")),h.setData("y",o.getData("y")),h.setData("wallKicks",o.getData("wallKicks")),h}function Gt(t,o,n){return t<o?n-(o-t)%(n-o):o+(t-o)%(n-o)}function Wt(t,o,n,r,u){originalRotation=r.getData("rotationIndex")||0,rotationIndex=Gt(originalRotation+u,0,4),DEBUG&&console.log("Rotation: ",rotationIndex),bt(r,u),He(t,o,n,r,rotationIndex,u)||(rotationIndex=originalRotation,bt(r,-u)),r.setData("rotationIndex",rotationIndex)}function He(t,o,n,r,u,h){for(wallKicks=r.getData("wallKicks"),wallKickIndex=Ce(u,h),DEBUG&&console.log("Wall kicks being evaluated: ",wallKicks[wallKickIndex]),i=0;i<5;i++)if(translation=wallKicks[wallKickIndex][i],G(t,o,n,r,translation))return DEBUG&&console.log("Wall kick success"),!0;return DEBUG&&console.log("Wall kick failure"),!1}function Ce(t,o){return wallKickIndex=t*2,o<0&&wallKickIndex--,Gt(wallKickIndex,0,8)}function Fe(t,o,n,r,u){let h=r.getData("cells"),p=r.getData("type"),g=r.getData("x"),T=r.getData("y");DEBUG&&(t.clear(),DEBUG&&console.log("Testing move: ",u));for(let y=0;y<h.length;y++){let w=g+h[y][0]+u[0],O=T+h[y][1]-u[1];if(DEBUG&&(wx=o.tileToWorldX(w),wy=o.tileToWorldY(20-O),t.lineStyle(1,16711935),t.strokeRectShape(new Phaser.Geom.Rectangle(wx,wy,64*n,64*n))),w%1!=0||O%1!=0)return DEBUG&&console.log("Bug: ",w,O),!1;let R=o.getTileAt(w,20-O);if(!R||R.index!==x.BOARD&&R.index!==x.GHOST)return DEBUG&&console.log("Tile occupied"),!1}return!0}function G(t,o,n,r,u){return isValid=Fe(t,o,n,r,u),isValid&&(r.setData("x",r.getData("x")+u[0]),r.setData("y",r.getData("y")-u[1]),r.x=o.tileToWorldX(r.getData("x")),r.y=o.tileToWorldY(19-r.getData("y"))),isValid}function bt(t,o){let n=Le[t.getData("type")],r=t.getData("cells"),u=t.getData("type"),h=RotationMatrix,p=[],g=u===J.O||u===J.I;if(g)for(let T=0;T<r.length;T++)r[T][0]-=.5,r[T][1]-=.5;for(let T=0;T<r.length;T++){let y=parseFloat((r[T][0]*h[0]*o+r[T][1]*h[1]*o).toFixed(1)),w=parseFloat((r[T][0]*h[2]*o+r[T][1]*h[3]*o).toFixed(1));p.push([g?Math.ceil(y):Math.round(y),g?Math.ceil(w):Math.round(w)])}return t.setData("cells",p),tmp=[parseFloat((n[0]*h[0]*o+n[1]*h[1]*o).toFixed(1)),parseFloat((n[0]*h[2]*o+n[1]*h[3]*o).toFixed(1))],t.setData("rotation",tmp),p}TetrominoBag=[];TetrominoQueue=[];var Mt=()=>{if(TetrominoBag.length===0){let o=Object.keys(J);for(let n=o.length-1;n>0;n--){let r=Math.floor(Math.random()*(n+1));[o[n],o[r]]=[o[r],o[n]]}TetrominoBag=[...o]}let t=TetrominoBag.pop();return DEBUG&&console.log("Tetromino bag: ",TetrominoBag),t};function Ge(){return TetrominoBag.length===0&&Mt(),[...TetrominoBag.slice(0,5)]}function be(){return TetrominoQueue}function ht(t){TetrominoBag.length=0;let o=Ge();TetrominoQueue.length=0;for(let n=0;n<o.length;n++)TetrominoQueue.push(M(t,o[n])),DEBUG&&console.log("Queue: ",TetrominoQueue)}function $(t,o,n,r){let u=TetrominoQueue.pop().setScale(r),h=u.getData("type");return u.setData("x",o),u.setData("y",n-(h===V.I?1:0)),DEBUG&&console.log("Spawned tetromino: ",u),TetrominoQueue.unshift(M(t,Mt())),u}function Xt(t){t.queueMap=t.make.tilemap({key:"queue",data:null,tileWidth:BLOCK_SIZE,tileHeight:BLOCK_SIZE});let o=t.queueMap.addTilesetImage("queue_tiles","block",BLOCK_SIZE,BLOCK_SIZE,0,0,0);t.queueLayer=t.queueMap.createBlankLayer("QueueLayer",o,t.center.x+(BOARD_WIDTH+.6)/2*BLOCK_SIZE*t.gameScale,97,5,16).setScale(t.gameScale*.75),t.queueLayer.setPipeline("Light2D")}function tt(t){let o=be();t.queueMap.fill(Tiles.BOARD,1,1,4,14,!0);for(let n=0;n<o.length;n++){let r=o[n],u=r.getData("cells"),h=r.getData("tile");for(let p=0;p<u.length;p++)for(let g=0;g<u[p].length-1;g++)t.queueMap.putTileAt(h,2+u[p][g],12-n*3-u[p][g+1]+2,!1,"QueueLayer")}}heldPiece=null;hasSwapped=!1;function jt(t){let o=Array.from({length:4},()=>Array.from({length:6},()=>x.BOARD));t.holdMap=t.make.tilemap({key:"hold_tiles",data:o,tileWidth:BLOCK_SIZE,tileHeight:BLOCK_SIZE});let n=t.holdMap.addTilesetImage("tiles","block",BLOCK_SIZE,BLOCK_SIZE,0,0,0);t.holdLayer=t.holdMap.createBlankLayer("HoldLayer",n,t.center.x-(BOARD_WIDTH+9.6)/2*BLOCK_SIZE*t.gameScale,97).setScale(t.gameScale*.75),t.holdLayer.setPipeline("Light2D"),t.holdMap.fill(x.BOARD,1,1,4,2,!0)}function We(){return heldPiece}function Me(t){if(heldPiece){if(hasSwapped)return t.activePiece;{let o=M(t,t.activePiece.getData("type")),n=Object.assign(heldPiece);return n.setData("x",t.activePiece.getData("x")),n.setData("y",t.activePiece.getData("y")),heldPiece=o,hasSwapped=!0,n}}else{heldPiece=M(t,t.activePiece.getData("type"));let o=$(t,4,19,heldPiece.scale);return hasSwapped=!0,o}}function Kt(t){t.clearTetromino(t.activePiece);let o=Me(t);if(o===t.activePiece)je(t);else{t.holdText.setText("SWAP"),t.activePiece=o;let n=j(t,t.activePiece);n[0]<0?t.activePiece.setData("x",t.activePiece.getData("x")-n[0]):n[1]>BOARD_WIDTH&&t.activePiece.setData("x",t.activePiece.getData("x")-(n[1]-BOARD_WIDTH)),tt(t),Xe(t)}t.updateGhost(),t.setTetromino(t.activePiece)}function Xe(t){let o=We(),n=o.getData("cells"),r=o.getData("tile");t.holdMap.fill(x.BOARD,1,1,4,2,!0);for(let u=0;u<n.length;u++)for(let h=0;h<n[u].length-1;h++)t.holdMap.putTileAt(r,2+n[u][h],2-n[u][h+1],!1,"HoldLayer")}function ut(t){t.holdMap.fill(x.BOARD,1,1,4,2,!0),t.holdText.setText("HOLD"),Ke()}function Nt(){hasSwapped=!1}function Ke(){hasSwapped=!1,heldPiece=null}function je(t){t.holdText.setColor("#FF0077"),t.tweens.add({targets:t.holdText,x:t.holdText.x-10,duration:20,yoyo:!1,repeat:0,onComplete:()=>{t.holdText.x=88*t.gameScale,t.tweens.add({targets:t.holdText,x:t.holdText.x+20,duration:60,yoyo:!0,repeat:1,ease:"OutCircle",onComplete:()=>{t.holdText.x=89*t.gameScale,t.holdText.setColor("#00DDFF")}})}});for(let o=0;o<t.getTetrominoTiles().length;o++)t.tweens.add({targets:t.map.getTileAt(t.getTetrominoTiles()[o][0],BOARD_HEIGHT-t.getTetrominoTiles()[o][1]),alpha:.5,duration:50,yoyo:!0,repeat:0,ease:"EaseOutCubic",onUpdate:(n,r)=>{r.index===x.BOARD&&(r.alpha=1)},onComplete:()=>{t.map.getTileAt(t.getTetrominoTiles()[o][0],BOARD_HEIGHT-t.getTetrominoTiles()[o][1]).alpha=16777215}})}function Zt(t){t.add.image(t.center.x,t.center.y,"bg").setScale(t.gameScale*1.6),t.lights.enable().setAmbientColor(15658734);let o=t.lights.addLight(WIDTH,-HEIGHT,HEIGHT*3,16777215,4);t.map=t.make.tilemap({key:"map_tiles",data:t.level,tileWidth:BLOCK_SIZE,tileHeight:BLOCK_SIZE});let n=t.map.addTilesetImage("tiles","block",BLOCK_SIZE,BLOCK_SIZE,0,0,0);t.ghostLayer=t.map.createBlankLayer("GhostLayer",n,t.center.x-BOARD_WIDTH/2*BLOCK_SIZE*t.gameScale,3*BLOCK_SIZE*t.gameScale).setScale(t.gameScale),t.layer=t.map.createBlankLayer("GameLayer",n,t.center.x-BOARD_WIDTH/2*BLOCK_SIZE*t.gameScale,3*BLOCK_SIZE*t.gameScale).setScale(t.gameScale),t.layer.setPipeline("Light2D"),t.layer.setDepth(1),t.map.fill(Tiles.BOARD)}function Ut(t){t.input.addPointer(1),t.input.keyboard.on("keydown-LEFT",()=>{t.moveActivePiece([-1,0])}),t.input.keyboard.on("keydown-RIGHT",()=>{t.moveActivePiece([1,0])}),t.input.keyboard.on("keydown-DOWN",()=>{t.moveActivePiece([0,1])}),DEBUG&&t.input.keyboard.on("keydown-UP",()=>{t.moveActivePiece([0,-1])}),t.input.keyboard.on("keydown-E",()=>{t.rotateActivePiece(1)}),t.input.keyboard.on("keydown-Q",()=>{t.rotateActivePiece(-1)}),t.input.keyboard.on("keydown-SPACE",()=>{t.drop()}),t.input.keyboard.on("keydown-ENTER",()=>{t.hold()}),t.input.keyboard.on("keydown-P",()=>{t.scene.isPaused()?t.scene.resume():t.scene.pause()}),t.input.keyboard.on("keydown-ESC",()=>{t.reset()})}isClicking=!1;dropped=!1;held=!1;clicked=!1;dragged=!1;touchDeltaX=0;touchDeltaY=0;function Yt(t){if(t.input.activePointer.isDown){clicked=!0;let o=Math.abs(t.input.activePointer.x-touchDeltaX),n=Math.abs(t.input.activePointer.y-touchDeltaY);o>=75&&o>n?(t.input.activePointer.x<touchDeltaX?swipeDirection="left":t.input.activePointer.x>touchDeltaX&&touchDeltaX!=0?swipeDirection="right":(swipeDirection="",touchDeltaX=0),touchDeltaX=t.input.activePointer.x,swipeDirection!=""&&(t.moveActivePiece([swipeDirection=="left"?-1:1,0]),dragged=!0)):!dropped&&!held&&n>=200&&n>o&&(t.input.activePointer.y>touchDeltaY&&touchDeltaY!=0?swipeDirection="down":t.input.activePointer.y<touchDeltaY&&touchDeltaY!=0?swipeDirection="up":(swipeDirection="",touchDeltaY=0),touchDeltaY=t.input.activePointer.y,swipeDirection=="down"?(t.drop(),dropped=!0):swipeDirection=="up"&&(t.hold(),held=!0))}else touchDeltaX=0,touchDeltaY=0,clicked&&!dragged&&!dropped&&!held&&!t.gameOver&&(t.input.activePointer.x<t.center.x?t.rotateActivePiece(-1):t.rotateActivePiece(1)),clicked=!1,dropped=!1,dragged=!1,held=!1}var A,_,C,L,E=null,N=null,Ne=null,Ze=null,Ue=null,X=x.BONUS_2X,et=5e3;function qt(t){A=t.add.nineslice(t.center.x,HEIGHT-50,"ui","ButtonOrange",BOARD_WIDTH*t.gameScale*BLOCK_SIZE),_=t.add.nineslice(t.center.x-190,HEIGHT-52,"ui","ButtonOrangeFill1",BOARD_WIDTH*t.gameScale*BLOCK_SIZE-22,30,6,6),L=t.add.text(t.center.x-32,HEIGHT-64,"2X",{font:'20px "Exo"',fill:"#FFFFFF"}).setName("bonusText").setAlpha(0),A.alpha=0,_.alpha=0,_.setOrigin(0,.5)}function Qt(t){t.tweens.killTweensOf(_),t.tweens.killTweensOf(A),t.tweens.killTweensOf(C),t.tweens.killTweensOf(E),E&&E.stop(),A.alpha=0,_.alpha=0,L.alpha=0,C=null}function Ye(t,o){K(t,parseInt(o[0]-1)*t.lastScore);var n=t.add.text(t.center.x,HEIGHT-52,o,{font:'900 20px "Broadway"',fill:o==="2X"?"#0000FF":o==="3X"?"#00AA00":"#FF0000",fontStyle:{weight:"bold"}}).setOrigin(.5,.5);n.depth=100,n.angle=-1,n.setStroke("#fff",10),t.tweens.add({targets:[n],y:HEIGHT-250,alpha:0,scale:5,duration:1e3,yoyo:!1,repeat:0,onComplete:()=>{n.destroy()}})}function Jt(t){if(N&&N.isPlaying()&&N.progress<1&&N.elapsed>250)switch(t.tweens.killTweensOf(_),t.tweens.killTweensOf(A),t.tweens.killTweensOf(C),t.tweens.killTweensOf(E),E&&E.start(),Ye(t,L.text),X){case x.BONUS_2X:X=x.BONUS_3X,L.text="3X";break;case x.BONUS_3X:case x.BONUS_4X:X=x.BONUS_4X,L.text="4X";break;default:X=x.BONUS_2X,L.text="2X";break}else X=x.BONUS_2X,L.text="2X";_.width=BOARD_WIDTH*t.gameScale*BLOCK_SIZE-22,_.alpha=1,A.alpha=1,L.alpha=0,C=L,C.alpha=1,C.x=t.center.x-32,E?(E.x=t.center.x-15,E.start()):E=t.add.particles(t.center.x-15,HEIGHT-55,"particles",{active:!0,visible:!0,collideBottom:!0,collideLeft:!0,collideRight:!0,collideTop:!0,on:!0,particleBringToTop:!0,radial:!0,frame:{frames:["star_08"],cycle:!1,quantity:10},frequency:0,gravityX:0,gravityY:1e3,maxParticles:100,timeScale:1,blendMode:0,accelerationX:0,accelerationY:{start:1,end:0,ease:"Linear"},alpha:{ease:"Quad.easeOut",start:1,end:0},angle:{ease:"Expo.easeOut",min:0,max:360},bounce:0,delay:0,lifespan:248,maxVelocityX:1e4,maxVelocityY:1e4,moveToX:0,moveToY:0,quantity:1,rotate:360,scale:.5,speed:{start:200,end:0,ease:"Quad.easeIn"},x:205,y:0,tint:[16711680,16718592,16768768,16741632,16775090],emitZone:{source:new Phaser.Geom.Line(0,0,0,10),type:"edge",quantity:10,stepRate:0,yoyo:!1,seamless:!1}}),N=t.tweens.add({targets:[_],width:0,alpha:.1,duration:et,yoyo:!1,repeat:0,onComplete:()=>{X=x.BONUS_2X,t.tweens.killTweensOf(_)}}),Ne=t.tweens.add({targets:[A],alpha:.1,duration:et,yoyo:!1,repeat:0,onComplete:()=>{A.alpha=0,_.alpha=0,t.tweens.killTweensOf(A)}}),Ze=t.tweens.add({targets:[C],x:t.center.x-190,alpha:0,duration:et,yoyo:!1,repeat:0,onComplete:()=>{t.tweens.killTweensOf(C)}}),Ue=t.tweens.add({targets:[E],x:0,duration:et,yoyo:!1,repeat:0,onComplete:()=>{E.stop(),t.tweens.killTweensOf(E)}})}function Vt(t){t.add.nineslice(-1,48,"ui","PopupBackground400",200,197,100,50,100,52).setOrigin(0,0),t.add.nineslice(-1,199,"ui","PopupBackground400",200,197,100,50,100,52).setOrigin(0,0),t.add.nineslice(WIDTH-196.5,48,"ui","PopupBackground400",200,556,100,100,100,100).setOrigin(0,0),t.add.nineslice(167,47,"ui","PopupBackground400",469,924,100,100,100,100).setOrigin(0,0),t.scoreLabelText=t.add.text(86*t.gameScale,372*t.gameScale,"SCORE",{font:'28px "Exo"',fill:"#00DDFF"}).setName("scoreLabelText"),t.scoreText=t.add.text(145*t.gameScale,465*t.gameScale,"0",{font:'30px "Exo"',fill:"#00DDFF"}).setName("scoreLabelText"),t.holdText=t.add.text(100*t.gameScale,130*t.gameScale,"HOLD",{font:'28px "Exo"',fill:"#00DDFF"}).setName("holdText"),t.nextText=t.add.text(WIDTH-210*t.gameScale,130*t.gameScale,"NEXT",{font:'28px "Exo"',fill:"#00DDFF"}).setName("nextText"),t.timeText=t.add.text(48*t.gameScale,HEIGHT-220*t.gameScale,"0:00.000",{font:'28px "Exo"',fill:"#00DDFF"}).setName("timeText"),qt(t)}function K(t,o){for(t.scoreText.setText(parseInt(t.scoreText.text)+o),t.scoreText.setFontSize(30);t.scoreText.width>199;)t.scoreText.setFontSize(t.scoreText.fontSize-1),t.scoreText.setText(parseInt(t.scoreText.text)+o);t.scoreText.setX(96-t.scoreText.width/2)}function zt(t){t.scoreText.setText("0"),t.scoreText.setX(96-t.scoreText.width/2)}var te=Re($t()),ft=class extends Phaser.Loader.File{constructor(o,n,r="google"){super(o,{type:"webfont",key:n.toString()});this.fontNames=Array.isArray(n)?n:[n],this.service=r}load(){let o={active:()=>{this.loader.nextFile(this,!0)}};switch(this.service){case"google":o.google={families:this.fontNames};break;default:throw new Error("Unsupported font service")}te.default.load(o)}},st=ft;var dt="Bungee",pt=class extends Phaser.Scene{constructor(){super({key:"GameOver",active:!1});this.i=0,this.timer=0}preload(){this.load.addFile(new st(this.load,dt))}create(){this.hsv=Phaser.Display.Color.HSVColorWheel(),this.timer=0,this.foregroundText=this.add.text(130,220,`game
 over`,{font:'900 160px "'+dt+'"',fill:"#transparent",fontStyle:{weight:"bold"}}),this.foregroundText.angle=0,this.foregroundText.setStroke("#fff",50),this.gameOverText=this.add.text(130,220,`game
 over`,{font:'900 160px "'+dt+'"',fill:"#fff",fontStyle:{weight:"bold"}}),this.gameOverText.angle=0,this.gameOverText.setShadow(4,4,"#000000",10,!1,!0),this.gameOverText.setStroke("transparent",50),this.input.keyboard.on("keydown",function(o){this.timer>500&&(this.scene.stop("GameOver"),this.scene.start("Jetris"))},this),this.input.addPointer(1)}update(o,n){this.timer+=n;let r=this.hsv[Math.round(this.i)].color,u=this.hsv[359-Math.round(this.i)].color;this.gameOverText.setTint(r,r,u,u),this.i+=n/30,this.i>=359&&(this.i=0),this.timer>500&&this.input.activePointer.isDown&&(this.input.activePointer.isDown=!1,this.scene.stop("GameOver"),this.scene.start("Jetris"))}},ee=pt;WIDTH=800;HEIGHT=1024;DEBUG=!1;BOARD_WIDTH=10;BOARD_HEIGHT=20;BLOCK_SIZE=64;swipeDirection="";touchDeltaX=0;touchDeltaY=0;swipeDelay=0;DROP_DELAY=1e3;var ie=class extends Phaser.Scene{constructor(){super({key:"Jetris",active:!0});this.container,this.level=Array.from({length:BOARD_HEIGHT},()=>Array.from({length:BOARD_WIDTH},()=>x.BOARD)),this.map,this.queueMap,this.holdMap,this.center={x:WIDTH/2,y:HEIGHT/2},this.deltaX=this.center.x*2/8,this.deltaY=this.center.y*2/20,this.gameScale=this.deltaX*2.5/this.center.x,this.gameScaleY=this.deltaY*2.5/this.center.y,this.adjustedBlockSize=BLOCK_SIZE*this.gameScale,this.activePiece,this.ghostPiece,this.graphics,this.gameOver=!1,this.layer,this.ghostLayer,this.rockLayer,this.waterLayer,this.rowClearParticles,this.particleEmitter,this.timer,this.elapsedSeconds=0,this.tetrominoTimer,this.activePieceTiles,this.lastScore}preload(){this.load.addFile(new st(this.load,"Exo")),this.load.image("block",["assets/Sprites/tetris.png","assets/Sprites/tetris_n.png"]),this.load.atlas("particles","assets/particles/shapes.png","assets/particles/shapes.json"),this.load.atlas("ui","assets/ui/nine-slice.png","assets/ui/nine-slice.json"),this.load.spritesheet("fullscreen","assets/ui/fullscreen.png",{frameWidth:BLOCK_SIZE,frameHeight:BLOCK_SIZE}),this.load.spritesheet("blocks","assets/Sprites/tetris.png",{frameWidth:BLOCK_SIZE,frameHeight:BLOCK_SIZE}),this.load.atlas("flares","assets/particles/blocks.png","assets/particles/blocks.json"),this.load.image("trail","assets/particles/trail.png"),this.load.image("streak","assets/particles/streak.png"),this.load.image("star","assets/particles/star.png"),this.load.image("bg","assets/images/bg.png")}createTileMaps(){Zt(this),Vt(this),jt(this),Xt(this)}checkFractions(o,n){return o%1!=0||n%1!=0?(DEBUG&&console.log("bug: ",o,n),!0):!1}setTile(o,n,r){this.checkFractions(o,n)||(this.map.putTileAt(r,o,BOARD_HEIGHT-n,!1,r===x.GHOST?"GhostLayer":"GameLayer"),r===x.BOARD&&this.map.removeTileAt(o,BOARD_HEIGHT-n,!0,!1,"GhostLayer"))}getTile(o,n){return this.checkFractions(o,n)?null:this.map.getTileAt(o,BOARD_HEIGHT-n,!1,this.layer)}setTetromino(o){let n=o.getData("cells"),r=o.getData("x"),u=o.getData("y");if(this.checkFractions(r,u)){DEBUG&&console.log("SetTetromino: ",o);return}this.tetrominoTiles=[];for(let h=0;h<n.length;h++)for(let p=0;p<n[h].length-1;p++){if(this.checkFractions(n[h][p],n[h][p+1])){DEBUG&&console.log("Move Data!!",tetrommino);return}let g=this.getTile(r+n[h][p],u+n[h][p+1]);if(g&&g.index===x.BOARD)this.setTile(r+n[h][p],u+n[h][p+1],o.getData("tile")),this.tetrominoTiles.push([r+n[h][p],u+n[h][p+1]]);else{this.GameOver();return}}}getTetrominoTiles(){return this.tetrominoTiles}clearTetromino(o){let n=o.getData("cells"),r=o.getData("x"),u=o.getData("y");if(!this.checkFractions(r,u))for(let h=0;h<n.length;h++)for(let p=0;p<n[h].length-1;p++){if(this.checkFractions(n[h][p],n[h][p+1]))return;this.setTile(r+n[h][p],u+n[h][p+1],x.BOARD)}}addFullScreenToggle(){let o=this.add.image(WIDTH-16,16,"fullscreen",0).setOrigin(1,0).setScale(.25).setInteractive();o.on("pointerup",function(){this.scale.isFullscreen?(o.setFrame(0),this.scale.stopFullscreen()):(o.setFrame(1),this.scale.startFullscreen())},this)}moveActivePiece(o){this.activePiece&&(this.clearTetromino(this.activePiece),G(this.graphics,this.map,this.gameScale,this.activePiece,o),this.updateGhost(),this.setTetromino(this.activePiece))}clearHold(){ut(this)}hold(){this.gameOver||Kt(this)}rotateActivePiece(o){this.clearTetromino(this.activePiece),Wt(this.graphics,this.map,this.gameScale,this.activePiece,o),this.updateGhost(),this.setTetromino(this.activePiece)}lockTetromino(o){Nt();let n=new Set,r=o.getData("cells"),u=o.getData("x"),h=o.getData("y");if(this.checkFractions(u,h))return;for(let g=0;g<r.length;g++)for(let T=0;T<r[g].length-1;T++){if(this.checkFractions(r[g][T],r[g][T+1]))return;n.add(h+r[g][T+1])}n=Array.from(n).sort((g,T)=>T-g);let p=0;for(let g=0;g<n.length;g++){let T=n[g],y=!0;for(let w=0;w<BOARD_WIDTH;w++){let O=this.getTile(w,T);if(!O||O.index===x.BOARD){y=!1;break}}if(y){p++;for(let w=0;w<BOARD_WIDTH;w++)this.setTile(w,T,x.BOARD);for(let w=T+1;w<BOARD_HEIGHT;w++)for(let O=0;O<BOARD_WIDTH;O++){let R=this.getTile(O,w);R&&R.index!==x.BOARD&&(this.setTile(O,w-1,R.index),this.setTile(O,w,x.BOARD))}this.showRowClearFX(T-1)}}p>0&&(this.lastScore=n[0]*(p===1?100:p===2?300:p===3?500:800),K(this,this.lastScore),Jt(this))}stopBonusCountDown(){Qt(this)}GameOver(){this.gameOver=!0,this.clearHold(),this.tetrominoTimer.remove(),this.timer.remove(),this.scene.launch("GameOver")}drawDropAnimation(){let o=j(this,this.activePiece),n=j(this,this.ghostPiece),r=this.map.worldToTileY(n.bottom)-this.map.worldToTileY(o.bottom);K(this,r);let u=this.add.image(o.centerX,o.top,"trail");u.setOrigin(.5,0),u.setTint(this.activePiece.getData("color")),u.displayWidth=o.width,u.displayHeight=n.bottom-o.top,u.depth=0,this.tweens.add({targets:u,displayHeight:0,y:n.bottom,alpha:.3,duration:400,ease:"Linear",onComplete:()=>{u.destroy()}});let h=this.add.particles(0,0,"star",{speed:{onEmit:(g,T,y,w)=>Phaser.Math.Between(500,1100)},angle:{min:-95,max:-85},scale:{start:.065,end:0},alpha:{start:.7,end:0},rotate:{onEmit:(g,T,y,w)=>Phaser.Math.Between(-360,360),onUpdate:(g,T,y,w)=>w+Phaser.Math.Between(1,5)*(g.lifeCurrent/g.life)},quantity:5,lifespan:550,blendMode:"NORMAL",gravityY:0,on:!1,onComplete:()=>{h.destroy()}});h.stop(),h.addEmitZone({type:"random",source:new Phaser.Geom.Line(n.left,n.top,n.right,n.top),quantity:10,minRotation:-360,maxRotation:360,onComplete:()=>{h.destroy()}}),h.explode();let p=this.add.particles(0,0,"streak",{speed:{min:1e3,max:3e3},angle:-90,scaleY:{start:.4,end:1},scaleX:.1,alpha:{start:.5,end:0},lifespan:350,blendMode:"ADD",manualEmit:!0,on:!1,onComplete:()=>{p.destroy()}});p.stop(),p.addEmitZone({type:"random",source:new Phaser.Geom.Line(n.left,n.top,n.right,n.top),quantity:10,onComplete:()=>{p.destroy()}}),p.start(50,50),this.cameras.main.shake(100,.0025-5e-4*(this.ghostPiece.getData("y")-this.activePiece.getData("y")))}drop(){if(!this.gameOver){for(this.drawDropAnimation(),this.clearTetromino(this.activePiece),this.clearTetromino(this.ghostPiece);G(this.graphics,this.map,this.gameScale,this.activePiece,[0,1]););this.setTetromino(this.activePiece),this.lockTetromino(this.activePiece),this.spawn(),this.setTetromino(this.activePiece),this.elapsed=0}}showRowClearFX(o){let n=this.add.particles(this.center.x*this.gameScale,0,"flares",{frame:{frames:["blue","green","pink","yellow","purple"],cycle:!0},blendMode:"ADD",lifespan:200,quantity:2,manualEmit:!0,frequency:8,alpha:{start:1,end:0},scale:{start:.5,end:.3},onComplete:()=>{n.destroy()}});n.setDepth(2),n.stop(),n.addEmitZone({type:"edge",source:new Phaser.Geom.Line(this.map.tileToWorldX(-5.75),this.map.tileToWorldY(19.5-o),this.map.tileToWorldX(4.25),this.map.tileToWorldY(19.5-o)),quantity:10,total:1}),n.start(50,50)}updateTimer(){this.milliseconds=Math.trunc(this.timer.getElapsed());let o=Math.floor(this.elapsedSeconds/60),n=Math.floor(this.elapsedSeconds%60),r=this.milliseconds%1e3;this.timeText.setText(o.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")+"."+r.toString().padStart(3,"0"))}addSecond(){this.elapsedSeconds+=1}advanceActivePiece(){this.activePiece&&!DEBUG&&!this.gameOver?(this.clearTetromino(this.activePiece),G(this.graphics,this.map,this.gameScale,this.activePiece,[0,1])||(this.setTetromino(this.activePiece),this.lockTetromino(this.activePiece),this.spawn()),this.setTetromino(this.activePiece)):this.gameOver&&console.log("I'm still being called....:",this.timer)}create(){this.gameOver=!1,this.elapsedSeconds=0,this.milliseconds=0,this.createTileMaps(),this.addFullScreenToggle(),ht(this),Ut(this),this.graphics=this.add.graphics(),this.spawn(),this.setTetromino(this.activePiece),this.milliseconds=0,this.timer=this.time.addEvent({delay:1e3,callback:this.addSecond,callbackScope:this,loop:!0}),this.tetrominoTimer=this.time.addEvent({delay:DROP_DELAY,callback:this.advanceActivePiece,callbackScope:this,loop:!0}),console.log(window.innerWidth,window.innerHeight,window.devicePixelRatio)}spawn(){for(this.activePiece&&this.activePiece.destroy(),this.ghostPiece&&this.ghostPiece.destroy(),this.activePiece=$(this,4,19,this.gameScale),this.ghostPiece=Ft(this,this.activePiece,this.gameScale);G(this.graphics,this.map,this.gameScale,this.ghostPiece,[0,1]););this.setTetromino(this.ghostPiece),tt(this)}updateGhost(){for(this.clearTetromino(this.ghostPiece),this.ghostPiece.setData("x",this.activePiece.getData("x")),this.ghostPiece.setData("y",this.activePiece.getData("y")),this.ghostPiece.x=this.map.tileToWorldX(this.activePiece.getData("x")),this.ghostPiece.y=this.map.tileToWorldY(19-this.activePiece.getData("y")),this.ghostPiece.setData("cells",z(this.activePiece.getData("cells"))),this.ghostPiece.setData("rotationIndex",this.activePiece.getData("rotationIndex"));G(this.graphics,this.map,this.gameScale,this.ghostPiece,[0,1]););this.setTetromino(this.ghostPiece)}update(o,n){this.gameOver||(Yt(this),this.updateTimer())}reset(){this.map.fill(x.BOARD),this.map.fill(null,0,0,BOARD_WIDTH,BOARD_HEIGHT,!0,"GhostLayer"),ut(this),this.stopBonusCountDown(),this.thisOver=!1,this.elapsedSeconds=0,this.timer.reset({delay:1e3,callback:this.addSecond,callbackScope:this,loop:!0}),this.tetrominoTimer.reset({delay:DROP_DELAY,callback:this.advanceActivePiece,callbackScope:this,loop:!0}),ht(this),this.spawn(),this.setTetromino(this.activePiece),zt(this)}},qe={type:Phaser.WEBGL,scale:{mode:Phaser.Scale.FIT,parent:"jetris",autoCenter:Phaser.Scale.CENTER_BOTH,width:WIDTH,height:HEIGHT},width:WIDTH,height:HEIGHT,backgroundColor:"rgb(3, 23, 54)",scene:[ie,ee]},Ii=new Phaser.Game(qe);})();
