(()=>{var c=Tiles={BLUE:0,CYAN:1,ORANGE:2,YELLOW:3,GREEN:4,RED:5,PURPLE:6,BOARD:7,BORDER_BOTTOM:8,BORDER_LEFT:9,BORDER_TOP:10,BORDER_RIGHT:11,GHOST:12,HELPER:13,EMPTY:14,EMPTY2:15,BORDER_CORNER_BOTTOM_LEFT:16,BORDER_CORNER_TOP_LEFT:17,BORDER_CORNER_TOP_RIGHT:18,BORDER_CORNER_BOTTOM_RIGHT:19};cos=Math.cos(Math.PI/2);sin=Math.sin(Math.PI/2);RotationMatrix=[cos,sin,-sin,cos];TetrominoBag=[];TetrominoQueue=[];heldPiece=null;hasSwapped=!1;var B={L:"L",I:"I",J:"J",O:"O",S:"S",T:"T",Z:"Z"},E=()=>{if(TetrominoBag.length===0){let e=Object.keys(B);for(let t=e.length-1;t>0;t--){let a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}TetrominoBag=[...e]}let s=TetrominoBag.pop();return DEBUG&&console.log("Tetromino bag: ",TetrominoBag),s};function W(){return TetrominoBag.length===0&&E(),[...TetrominoBag.slice(0,3)]}var K={L:c.ORANGE,I:c.CYAN,J:c.BLUE,O:c.YELLOW,S:c.GREEN,T:c.PURPLE,Z:c.RED},g={I:[[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],[[0,0],[-1,0],[2,0],[-1,2],[2,-1]],[[0,0],[1,0],[-2,0],[1,-2],[-2,1]],[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],[[0,0],[1,0],[-2,0],[1,-2],[-2,1]],[[0,0],[-1,0],[2,0],[-1,2],[2,-1]]],JLOSTZ:[[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]],[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]]]};var C={I:[0,0],O:[0,0],J:[-.5,.5],L:[-.5,.5],S:[-.5,.5],T:[-.5,.5],Z:[-.5,.5]},O={L:{cells:[[1,1],[-1,0],[0,0],[1,0]],wallKicks:g.JLOSTZ,color:16753920},I:{cells:[[-1,1],[0,1],[1,1],[2,1]],wallKicks:g.I,color:65535},J:{cells:[[-1,1],[-1,0],[0,0],[1,0]],wallKicks:g.JLOSTZ,color:255},O:{cells:[[0,0],[1,0],[0,1],[1,1]],wallKicks:g.JLOSTZ,color:16776960},S:{cells:[[-1,0],[0,0],[0,1],[1,1]],wallKicks:g.JLOSTZ,color:65280},T:{cells:[[-1,0],[0,0],[1,0],[0,1]],wallKicks:g.JLOSTZ,color:8388736},Z:{cells:[[-1,1],[0,1],[0,0],[1,0]],wallKicks:g.JLOSTZ,color:16711680}};function y(s){return JSON.parse(JSON.stringify(s))}function w(s){let e=W();for(let t=0;t<e.length;t++)TetrominoQueue.push(T(s,e[t])),DEBUG&&console.log("Queue: ",TetrominoQueue)}function T(s,e){let t=O[e],a=s.add.container(0,0);return a.setData("cells",y(t.cells)),a.setData("color",t.color),a.setData("wallKicks",t.wallKicks),a.setData("tile",K[e]),a.setData("type",e),a.setData("rotationIndex",0),a.setData("rotation",[0,0]),a.setData("x",0),a.setData("y",0),DEBUG&&console.log("Created tetromino: ",a),a}function P(s,e,t,a){let o=TetrominoQueue.pop().setScale(a),l=o.getData("type");return o.setData("x",e),o.setData("y",t-(l===O.I?1:0)),DEBUG&&console.log("Spawned tetromino: ",o),TetrominoQueue.unshift(T(s,E())),o}function I(){return TetrominoQueue}function k(){return heldPiece}function R(s){if(heldPiece){if(hasSwapped)return s.activePiece;{let e=T(s,s.activePiece.getData("type")),t=Object.assign(heldPiece);return t.setData("x",s.activePiece.getData("x")),t.setData("y",s.activePiece.getData("y")),heldPiece=e,hasSwapped=!0,t}}else{heldPiece=T(s,s.activePiece.getData("type"));let e=P(s,4,19,heldPiece.scale);return hasSwapped=!0,e}}function L(){hasSwapped=!1}function v(){hasSwapped=!1,heldPiece=null}function A(s,e,t){let a=e.getData("type"),o=O[a],l=s.add.container(0,0).setScale(t);return l.setData("tile",c.GHOST),l.setData("cells",y(e.getData("cells"))),l.setData("type",e.getData("type")),l.setData("rotationIndex",e.getData("rotationIndex")),l.setData("rotation",e.getData("rotation")),l.setData("x",e.getData("x")),l.setData("y",e.getData("y")),l.setData("wallKicks",e.getData("wallKicks")),l}function H(s,e,t){return s<e?t-(e-s)%(t-e):e+(s-e)%(t-e)}function G(s,e,t,a,o){originalRotation=a.getData("rotationIndex")||0,rotationIndex=H(originalRotation+o,0,4),DEBUG&&console.log("Rotation: ",rotationIndex),x(a,o),Z(s,e,t,a,rotationIndex,o)||(rotationIndex=originalRotation,x(a,-o)),a.setData("rotationIndex",rotationIndex)}function Z(s,e,t,a,o,l){for(wallKicks=a.getData("wallKicks"),wallKickIndex=F(o,l),DEBUG&&console.log("Wall kicks being evaluated: ",wallKicks[wallKickIndex]),i=0;i<5;i++)if(translation=wallKicks[wallKickIndex][i],D(s,e,t,a,translation,!0))return DEBUG&&console.log("Wall kick success"),!0;return DEBUG&&console.log("Wall kick failure"),!1}function F(s,e){return wallKickIndex=s*2,e<0&&wallKickIndex--,H(wallKickIndex,0,8)}function b(s,e,t,a,o,l){let r=a.getData("cells"),h=a.getData("type"),p=a.getData("x"),n=a.getData("y");DEBUG&&(s.clear(),DEBUG&&console.log("Testing move: ",o));for(let d=0;d<r.length;d++){let u=p+r[d][0]+o[0],f=n+r[d][1]-o[1];if(DEBUG&&(wx=e.tileToWorldX(u),wy=e.tileToWorldY(20-f),s.lineStyle(1,16711935),s.strokeRectShape(new Phaser.Geom.Rectangle(wx,wy,64*t,64*t))),u%1!==0||f%1!==0)return DEBUG&&console.log("Bug: ",u,f),!1;let m=e.getTileAt(u,20-f);if(!m||m.index!==c.BOARD&&m.index!==c.GHOST)return DEBUG&&console.log("Tile occupied"),!1}return!0}function D(s,e,t,a,o,l){return isValid=b(s,e,t,a,o,l),isValid&&(a.setData("x",a.getData("x")+o[0]),a.setData("y",a.getData("y")-o[1]),a.x=e.tileToWorldX(a.getData("x")),a.y=e.tileToWorldY(19-a.getData("y"))),isValid}function x(s,e){let t=C[s.getData("type")],a=s.getData("cells"),o=s.getData("type"),l=RotationMatrix,r=[],h=o===B.O||o===B.I;if(h)for(let p=0;p<a.length;p++)a[p][0]-=.5,a[p][1]-=.5;for(let p=0;p<a.length;p++){let n=parseFloat((a[p][0]*l[0]*e+a[p][1]*l[1]*e).toFixed(1)),d=parseFloat((a[p][0]*l[2]*e+a[p][1]*l[3]*e).toFixed(1));r.push([h?Math.ceil(n):Math.round(n),h?Math.ceil(d):Math.round(d)])}return s.setData("cells",r),tmp=[parseFloat((t[0]*l[0]*e+t[1]*l[1]*e).toFixed(1)),parseFloat((t[0]*l[2]*e+t[1]*l[3]*e).toFixed(1))],s.setData("rotation",tmp),r}function _(s){s.input.addPointer(1),s.input.keyboard.on("keydown-LEFT",()=>{s.moveActivePiece([-1,0])}),s.input.keyboard.on("keydown-RIGHT",()=>{s.moveActivePiece([1,0])}),s.input.keyboard.on("keydown-DOWN",()=>{s.moveActivePiece([0,1])}),DEBUG&&s.input.keyboard.on("keydown-UP",()=>{s.moveActivePiece([0,-1])}),s.input.keyboard.on("keydown-E",()=>{s.rotateActivePiece(1)}),s.input.keyboard.on("keydown-Q",()=>{s.rotateActivePiece(-1)}),s.input.keyboard.on("keydown-SPACE",()=>{s.drop()}),s.input.keyboard.on("keydown-ENTER",()=>{s.hold()}),s.input.keyboard.on("keydown-P",()=>{s.scene.isPaused()?s.scene.resume():s.scene.pause()}),s.input.keyboard.on("keydown-ESC",()=>{s.map.fill(Tiles.BOARD),s.map.fill(null,0,0,BOARD_WIDTH,BOARD_HEIGHT,!0,"GhostLayer"),s.clearHold(),s.gameOver=!1,s.spawn(),s.setTetromino(s.activePiece)})}isClicking=!1;dropped=!1;clicked=!1;dragged=!1;touchDeltaX=0;touchDeltaY=0;function M(s){if(s.input.activePointer.isDown){clicked=!0;let e=Math.abs(s.input.activePointer.x-touchDeltaX),t=Math.abs(s.input.activePointer.y-touchDeltaY);e>=100&&e>t?(s.input.activePointer.x<touchDeltaX?swipeDirection="left":s.input.activePointer.x>touchDeltaX&&touchDeltaX!=0?swipeDirection="right":(swipeDirection="",touchDeltaX=0),touchDeltaX=s.input.activePointer.x,swipeDirection!=""&&(s.moveActivePiece([swipeDirection=="left"?-1:1,0]),dragged=!0)):!dropped&&t>=200&&t>e&&(s.input.activePointer.y>touchDeltaY&&touchDeltaY!=0?swipeDirection="down":(swipeDirection="",touchDeltaY=0),touchDeltaY=s.input.activePointer.y,swipeDirection=="down"&&(s.drop(),dropped=!0))}else touchDeltaX=0,touchDeltaY=0,clicked&&!dragged&&!dropped&&(s.input.activePointer.x<s.center.x?s.rotateActivePiece(-1):s.rotateActivePiece(1)),clicked=!1,dropped=!1,dragged=!1}WIDTH=800;HEIGHT=1024;DEBUG=!1;BOARD_WIDTH=10;BOARD_HEIGHT=20;BLOCK_SIZE=64;swipeDirection="";touchDeltaX=0;touchDeltaY=0;swipeDelay=0;var S=class extends Phaser.Scene{constructor(){super({key:"Jetris",active:!0}),this.container,this.level=Array.from({length:BOARD_HEIGHT},()=>Array.from({length:BOARD_WIDTH},()=>c.BOARD)),this.map,this.queueMap,this.holdMap,this.center={x:WIDTH/2,y:HEIGHT/2},this.deltaX=this.center.x*2/8,this.deltaY=this.center.y*2/20,this.gameScale=this.deltaX*2.5/this.center.x,this.gameScaleY=this.deltaY*2.5/this.center.y,this.adjustedBlockSize=BLOCK_SIZE*this.gameScale,this.elapsed=0,this.activePiece,this.ghostPiece,this.graphics,this.gameOver=!1,this.layer,this.ghostLayer,this.rockLayer,this.waterLayer,this.rowClearParticles,this.particleEmitter}preload(){this.load.image("block",["assets/Sprites/tetris.png","assets/Sprites/tetris_n.png"]),this.load.spritesheet("fullscreen","assets/ui/fullscreen.png",{frameWidth:BLOCK_SIZE,frameHeight:BLOCK_SIZE}),this.load.spritesheet("blocks","assets/Sprites/tetris.png",{frameWidth:BLOCK_SIZE,frameHeight:BLOCK_SIZE}),this.load.atlas("flares","assets/particles/blocks.png","assets/particles/blocks.json"),this.load.image("trail","assets/particles/trail.png"),this.load.image("streak","assets/particles/streak.png"),this.load.image("star","assets/particles/star.png"),this.load.image("bg","assets/images/bg.png")}createQueueMap(){let e=Array.from({length:9},()=>Array.from({length:4},()=>c.BOARD));for(let t=0;t<9;t++)for(let a=0;a<4;a++)a%2===0?e[t][a]=c.BOARD:e[t][a]=null;this.queueMap=this.make.tilemap({key:"queue_tiles",data:e,tileWidth:BLOCK_SIZE,tileHeight:BLOCK_SIZE}),this.queueTiles=this.queueMap.addTilesetImage("tiles","block",BLOCK_SIZE,BLOCK_SIZE,0,0,0),this.queueLayer=this.queueMap.createBlankLayer("QueueLayer",this.queueTiles,this.center.x+(BOARD_WIDTH+2)/2*BLOCK_SIZE*this.gameScale,3*BLOCK_SIZE*this.gameScale).setScale(this.gameScale*.75),this.queueLayer.setPipeline("Light2D"),this.queueMap.fill(c.BOARD,0,0,4,9,!0);for(let t=0;t<4;t++)for(let a=0;a<9;a++)a%3===2&&this.queueMap.removeTileAt(t,a,!0,!1,"QueueLayer")}createHoldMap(){let e=Array.from({length:2},()=>Array.from({length:4},()=>c.BOARD));this.holdMap=this.make.tilemap({key:"queue_tiles",data:e,tileWidth:BLOCK_SIZE,tileHeight:BLOCK_SIZE}),this.holdTiles=this.holdMap.addTilesetImage("tiles","block",BLOCK_SIZE,BLOCK_SIZE,0,0,0),this.holdLayer=this.holdMap.createBlankLayer("HoldLayer",this.queueTiles,this.center.x-(BOARD_WIDTH+8)/2*BLOCK_SIZE*this.gameScale,3*BLOCK_SIZE*this.gameScale).setScale(this.gameScale*.75),this.holdLayer.setPipeline("Light2D"),this.holdMap.fill(c.BOARD,0,0,4,2,!0)}createGameMap(){this.map=this.make.tilemap({key:"map_tiles",data:this.level,tileWidth:BLOCK_SIZE,tileHeight:BLOCK_SIZE});let e=this.map.addTilesetImage("tiles","block",BLOCK_SIZE,BLOCK_SIZE,0,0,0);this.ghostLayer=this.map.createBlankLayer("GhostLayer",e,this.center.x-BOARD_WIDTH/2*BLOCK_SIZE*this.gameScale,3*BLOCK_SIZE*this.gameScale).setScale(this.gameScale),this.layer=this.map.createBlankLayer("GameLayer",e,this.center.x-BOARD_WIDTH/2*BLOCK_SIZE*this.gameScale,3*BLOCK_SIZE*this.gameScale).setScale(this.gameScale),this.layer.setPipeline("Light2D"),this.map.fill(c.BOARD)}createTileMaps(){this.add.image(this.center.x,this.center.y,"bg").setScale(this.gameScale*1.6),this.lights.enable().setAmbientColor(15658734);let e=this.lights.addLight(WIDTH,-HEIGHT,HEIGHT*3,16777215,4);this.createQueueMap(),this.createHoldMap(),this.createGameMap()}checkFractions(e,t){return e%1!==0||t%1!==0?(DEBUG&&console.log("bug: ",e,t),!0):!1}setTile(e,t,a){this.checkFractions(e,t)||(this.map.putTileAt(a,e,BOARD_HEIGHT-t,!1,a===c.GHOST?"GhostLayer":"GameLayer"),a===c.BOARD&&this.map.removeTileAt(e,BOARD_HEIGHT-t,!0,!1,"GhostLayer"))}getTile(e,t){return this.checkFractions(e,t)?null:this.map.getTileAt(e,BOARD_HEIGHT-t,!1,this.layer)}setTetromino(e){let t=e.getData("cells"),a=e.getData("x"),o=e.getData("y");if(this.checkFractions(a,o)){DEBUG&&console.log("SetTetromino: ",e);return}for(let l=0;l<t.length;l++)for(let r=0;r<t[l].length-1;r++){if(this.checkFractions(t[l][r],t[l][r+1])){DEBUG&&console.log("Move Data!!",tetrommino);return}let h=this.getTile(a+t[l][r],o+t[l][r+1]);if(h&&h.index===c.BOARD)this.setTile(a+t[l][r],o+t[l][r+1],e.getData("tile"));else{this.gameOver=!0;return}}}clearHold(){this.holdMap.fill(c.BOARD,0,0,4,2,!0),v()}clearTetromino(e){let t=e.getData("cells"),a=e.getData("x"),o=e.getData("y");if(!this.checkFractions(a,o))for(let l=0;l<t.length;l++)for(let r=0;r<t[l].length-1;r++){if(this.checkFractions(t[l][r],t[l][r+1]))return;this.setTile(a+t[l][r],o+t[l][r+1],c.BOARD)}}addFullScreenToggle(){let e=this.add.image(WIDTH-16,16,"fullscreen",0).setOrigin(1,0).setScale(.25).setInteractive();e.on("pointerup",function(){this.scale.isFullscreen?(e.setFrame(0),this.scale.stopFullscreen()):(e.setFrame(1),this.scale.startFullscreen())},this)}moveActivePiece(e){this.activePiece&&(this.clearTetromino(this.activePiece),D(this.graphics,this.map,this.gameScale,this.activePiece,e),this.updateGhost(),this.setTetromino(this.activePiece))}hold(){let e=this.activePiece.getData("type");this.clearTetromino(this.activePiece);let t=R(this);if(t===this.activePiece){let a=this.getBoundingBox(this.activePiece);this.graphics.lineStyle(4,16711680,1),this.graphics.strokeRectShape(a),this.tweens.add({targets:this.graphics,alpha:0,duration:500,ease:"Linear",onComplete:()=>{this.graphics.clear(),this.graphics.alpha=1}})}else this.activePiece=t,this.drawQueue(),this.drawHold();this.updateGhost(),this.setTetromino(this.activePiece)}rotateActivePiece(e){this.clearTetromino(this.activePiece),G(this.graphics,this.map,this.gameScale,this.activePiece,e),this.updateGhost(),this.setTetromino(this.activePiece)}lockTetromino(e){L();let t=new Set,a=e.getData("cells"),o=e.getData("x"),l=e.getData("y");if(!this.checkFractions(o,l)){for(let r=0;r<a.length;r++)for(let h=0;h<a[r].length-1;h++){if(this.checkFractions(a[r][h],a[r][h+1]))return;t.add(l+a[r][h+1])}t=Array.from(t).sort((r,h)=>h-r);for(let r=0;r<t.length;r++){let h=t[r],p=!0;for(let n=0;n<BOARD_WIDTH;n++){let d=this.getTile(n,h);if(!d||d.index===c.BOARD){p=!1;break}}if(p){for(let n=0;n<BOARD_WIDTH;n++)this.setTile(n,h,c.BOARD);for(let n=h+1;n<BOARD_HEIGHT;n++)for(let d=0;d<BOARD_WIDTH;d++){let u=this.getTile(d,n);u&&u.index!==c.BOARD&&(this.setTile(d,n-1,u.index),this.setTile(d,n,c.BOARD))}this.showRowClearFX(h-1)}}}}getBoundingBox(e){let t=e.getData("cells"),a=e.getData("x"),o=e.getData("y");if(this.checkFractions(a,o))return;let l=BOARD_WIDTH,r=0,h=BOARD_HEIGHT,p=0;for(let n=0;n<t.length;n++)for(let d=0;d<t[n].length-1;d++){if(this.checkFractions(t[n][d],t[n][d+1]))return;l=Math.min(l,a+t[n][d]),r=Math.max(r,a+t[n][d]),h=Math.min(h,o+t[n][d+1]),p=Math.max(p,o+t[n][d+1])}return new Phaser.Geom.Rectangle(this.map.tileToWorldX(l),this.map.tileToWorldY(19-p)+BLOCK_SIZE*this.gameScale,this.map.tileToWorldX(r)-this.map.tileToWorldX(l)+BLOCK_SIZE*this.gameScale,this.map.tileToWorldY(19-h)-this.map.tileToWorldY(19-p)+BLOCK_SIZE*this.gameScale)}drawDropAnimation(){let e=this.getBoundingBox(this.activePiece),t=this.getBoundingBox(this.ghostPiece),a=this.add.image(e.centerX,e.centerY,"trail");a.setOrigin(.5,0),a.setTint(this.activePiece.getData("color")),a.displayWidth=e.width,a.displayHeight=t.y-e.y,a.depth=-1,this.tweens.add({targets:a,displayHeight:0,y:t.y,alpha:0,duration:200,ease:"Linear",onComplete:()=>{a.destroy()}});let o=this.add.particles(t.centerX,t.y,"star",{speed:{min:400,max:1e3},angle:{min:-105,max:-75},scale:{start:.1,end:0},alpha:{start:.4,end:0},quantity:5,lifespan:500,blendMode:"ADD",gravityY:100,on:!1,onComplete:()=>{o.destroy()}});o.explode(),this.graphics.lineStyle(4,65280,1),this.graphics.strokeRectShape(e),this.tweens.add({targets:this.graphics,alpha:0,duration:400,ease:"Linear",onComplete:()=>{this.graphics.clear(),this.graphics.alpha=1}}),this.cameras.main.shake(100,.0025-5e-4*(this.ghostPiece.getData("y")-this.activePiece.getData("y")))}drop(){if(!this.gameOver){for(this.drawDropAnimation(),this.clearTetromino(this.activePiece),this.clearTetromino(this.ghostPiece);D(this.graphics,this.map,this.gameScale,this.activePiece,[0,1]););this.setTetromino(this.activePiece),this.lockTetromino(this.activePiece),this.spawn(),this.setTetromino(this.activePiece),this.elapsed=0}}showRowClearFX(e){let t=this.add.particles(this.center.x*this.gameScale,0,"flares",{frame:{frames:["blue","green","pink","yellow","purple"],cycle:!0},blendMode:"ADD",lifespan:150,quantity:1,manualEmit:!0,frequency:5,alpha:{start:1,end:0},scale:{start:.4,end:.1},onComplete:()=>{t.destroy()}});t.stop(),t.addEmitZone({type:"edge",source:new Phaser.Geom.Line(this.map.tileToWorldX(-5.75),this.map.tileToWorldY(19.5-e),this.map.tileToWorldX(4.25),this.map.tileToWorldY(19.5-e)),quantity:10,total:1}),t.start(50,50)}create(){this.createTileMaps(),this.addFullScreenToggle(),w(this),_(this),this.spawn(),this.graphics=this.add.graphics(),this.setTetromino(this.activePiece),console.log(window.innerWidth,window.innerHeight,window.devicePixelRatio)}drawQueue(){let e=I();this.queueMap.fill(c.BOARD,0,0,4,9,!0);for(let t=0;t<e.length;t++){let a=e[t],o=a.getData("cells"),l=a.getData("tile");for(let r=0;r<o.length;r++)for(let h=0;h<o[r].length-1;h++)this.queueMap.putTileAt(l,1+o[r][h],6-t*3-o[r][h+1]+1,!1,"QueueLayer")}}drawHold(){let e=k(),t=e.getData("cells"),a=e.getData("tile");this.holdMap.fill(c.BOARD,0,0,4,2,!0);for(let o=0;o<t.length;o++)for(let l=0;l<t[o].length-1;l++)this.holdMap.putTileAt(a,1+t[o][l],1-t[o][l+1],!1,"HoldLayer")}spawn(){for(this.activePiece&&this.activePiece.destroy(),this.ghostPiece&&this.ghostPiece.destroy(),this.activePiece=P(this,4,19,this.gameScale),this.ghostPiece=A(this,this.activePiece,this.gameScale);D(this.graphics,this.map,this.gameScale,this.ghostPiece,[0,1]););this.setTetromino(this.ghostPiece),this.drawQueue()}updateGhost(){for(this.clearTetromino(this.ghostPiece),this.ghostPiece.setData("x",this.activePiece.getData("x")),this.ghostPiece.setData("y",this.activePiece.getData("y")),this.ghostPiece.x=this.map.tileToWorldX(this.activePiece.getData("x")),this.ghostPiece.y=this.map.tileToWorldY(19-this.activePiece.getData("y")),this.ghostPiece.setData("cells",y(this.activePiece.getData("cells"))),this.ghostPiece.setData("rotationIndex",this.activePiece.getData("rotationIndex"));D(this.graphics,this.map,this.gameScale,this.ghostPiece,[0,1]););this.setTetromino(this.ghostPiece)}update(e,t){this.gameOver||(M(this),this.elapsed+=t,this.elapsed>1e3&&(this.elapsed=0),this.elapsed===0&&this.activePiece&&!DEBUG&&(this.clearTetromino(this.activePiece),D(this.graphics,this.map,this.gameScale,this.activePiece,[0,1])||(this.setTetromino(this.activePiece),this.lockTetromino(this.activePiece),this.spawn()),this.setTetromino(this.activePiece)))}},Y={type:Phaser.WEBGL,scale:{mode:Phaser.Scale.FIT,parent:"jetris",autoCenter:Phaser.Scale.CENTER_BOTH,width:WIDTH,height:HEIGHT},width:WIDTH,height:HEIGHT,backgroundColor:"rgb(3, 23, 54)",scene:[S]},ee=new Phaser.Game(Y);})();
